<!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#main -->
<!-- Under ParameterList required: mesh, regions, cycle driver, PKs, state  -->
<!-- Under ParameterList optional: checkpoint, visualization, observations  -->
<ParameterList name="Main" type="ParameterList">
  
  <!--  https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#mesh -->
  <ParameterList name="mesh" type="ParameterList">
    <ParameterList name="surface" type="ParameterList">
      <Parameter name="mesh type" type="string" value="surface" />
      <ParameterList name="expert" type="ParameterList">
        <Parameter name="verify mesh" type="bool" value="false" />
      </ParameterList>
      <ParameterList name="surface parameters" type="ParameterList">
        <Parameter name="surface sideset name" type="string" value="surface face" />
      </ParameterList>
    </ParameterList>
    
    <ParameterList name="domain" type="ParameterList">
      <Parameter name="mesh type" type="string" value="read mesh file" />
      <Parameter name="build columns from set" type="string" value="surface face" />
      <ParameterList name="read mesh file parameters" type="ParameterList">
        <Parameter name="file" type="string" value="../data/column.exo" />
        <Parameter name="format" type="string" value="Exodus II" />
      </ParameterList>
    </ParameterList>
    
    <ParameterList name="snow" type="ParameterList">
      <Parameter name="mesh type" type="string" value="aliased" />
      <ParameterList name="aliased parameters" type="ParameterList">
        <Parameter name="alias" type="string" value="surface" />
      </ParameterList>
    </ParameterList>
  </ParameterList>

  <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#region -->
  <ParameterList name="regions" type="ParameterList">
    <ParameterList name="subsurface domain" type="ParameterList">
      <ParameterList name="region: all" type="ParameterList">
      </ParameterList>
    </ParameterList>
    <ParameterList name="surface domain" type="ParameterList">
      <ParameterList name="region: all" type="ParameterList">
      </ParameterList>
    </ParameterList>
    <ParameterList name="subsurface domain peat" type="ParameterList">
      <ParameterList name="region: labeled set" type="ParameterList">
        <Parameter name="label" type="string" value="1001" />
        <Parameter name="file" type="string" value="../data/column.exo" />
        <Parameter name="format" type="string" value="Exodus II" />
        <Parameter name="entity" type="string" value="cell" />
      </ParameterList>
    </ParameterList>
    <ParameterList name="subsurface domain mineral" type="ParameterList">
      <ParameterList name="region: labeled set" type="ParameterList">
        <Parameter name="label" type="string" value="1002" />
        <Parameter name="file" type="string" value="../data/column.exo" />
        <Parameter name="format" type="string" value="Exodus II" />
        <Parameter name="entity" type="string" value="cell" />
      </ParameterList>
    </ParameterList>
    <ParameterList name="surface face" type="ParameterList">
      <ParameterList name="region: labeled set" type="ParameterList">
        <Parameter name="label" type="string" value="2" />
        <Parameter name="file" type="string" value="../data/column.exo" />
        <Parameter name="format" type="string" value="Exodus II" />
        <Parameter name="entity" type="string" value="face" />
      </ParameterList>
    </ParameterList>
    <ParameterList name="bottom face" type="ParameterList">
      <ParameterList name="region: labeled set" type="ParameterList">
        <Parameter name="label" type="string" value="1" />
        <Parameter name="file" type="string" value="../data/column.exo" />
        <Parameter name="format" type="string" value="Exodus II" />
        <Parameter name="entity" type="string" value="face" />
      </ParameterList>
    </ParameterList>
  </ParameterList>

  <!--  https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#coordinator -->
  <ParameterList name="cycle driver" type="ParameterList">
    <Parameter name="end cycle" type="int" value="3000" />
    <Parameter name="start time" type="double" value="0.0" />
    <Parameter name="start time units" type="string" value="s" />
    <Parameter name="end time" type="double" value="1.0" />
    <Parameter name="end time units" type="string" value="noleap" />
    <ParameterList name="required times" type="ParameterList">
      <Parameter name="times start period stop" type="Array(double)" value="{0,1,-1}" />
      <Parameter name="times start period stop units" type="string" value="d" />
    </ParameterList>
    <!-- PK tree: list of PKs -->
    <ParameterList name="PK tree" type="ParameterList">
      <ParameterList name="Top level MPC" type="ParameterList">
        <Parameter name="PK type" type="string" value="strong MPC" />
        
        <!-- surface energy balance PK-->
        <ParameterList name="SEB" type="ParameterList">
          <Parameter name="PK type" type="string" value="surface balance implicit subgrid" />
        </ParameterList>
        
        <!-- surface/subsurface permafrost PKs mpc, including 4 PKs -->
        <ParameterList name="permafrost surface and subsurface" type="ParameterList">
          <Parameter name="PK type" type="string" value="permafrost model" />
          <ParameterList name="subsurface flow" type="ParameterList">
            <Parameter name="PK type" type="string" value="permafrost flow" />
          </ParameterList>
          <ParameterList name="surface flow" type="ParameterList">
            <Parameter name="PK type" type="string" value="overland flow with ice" />
          </ParameterList>
          <ParameterList name="subsurface energy" type="ParameterList">
            <Parameter name="PK type" type="string" value="three-phase energy" />
          </ParameterList>
          <ParameterList name="surface energy" type="ParameterList">
            <Parameter name="PK type" type="string" value="surface energy" />
          </ParameterList>
        </ParameterList>
        
      </ParameterList>
    </ParameterList>
  </ParameterList>

  <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#pk  -->
  <ParameterList name="PKs" type="ParameterList">

    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#mpc -->
    <ParameterList name="Top level MPC" type="ParameterList">
      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#physical-mpcs -->
      <!-- currently supported physical mpcs: coupled water, coupled cells, subsurface, surface(?), permafrost, strong, weak -->

      <Parameter name="PK type" type="string" value="strong MPC" />
      <Parameter name="PKs order" type="Array(string)" value="{SEB,permafrost surface and subsurface}" />
      
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#timeintegrator -->
      <!-- NOTE: this applies for all pks included in this MPC -->
      <ParameterList name="time integrator" type="ParameterList">
        <Parameter name="extrapolate initial guess" type="bool" value="true" />

        <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#nonlinear-solver  -->
        <Parameter name="solver type" type="string" value="nka_bt_ats" />
        <ParameterList name="nka_bt_ats parameters" type="ParameterList">
           <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#solver-nka-with-backtracking-ats -->
          <Parameter name="backtrack max steps" type="int" value="10" />
          <Parameter name="backtrack factor" type="double" value="0.25" />
          <Parameter name="backtrack tolerance" type="double" value="0.0001" />
          <Parameter name="nonlinear tolerance" type="double" value="1e-06" />
          <Parameter name="diverged tolerance" type="double" value="1000000.0" />
          <Parameter name="limit iterations" type="int" value="21" />
          <ParameterList name="verbose object" type="ParameterList">
            <Parameter name="verbosity level" type="string" value="high" />
          </ParameterList>
        </ParameterList>

        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="high" />
        </ParameterList>
        
        <!--https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#timestep-controller  -->
        <Parameter name="timestep controller type" type="string" value="smarter" />
        <ParameterList name="timestep controller smarter parameters" type="ParameterList">
          <Parameter name="max iterations" type="int" value="18" />
          <Parameter name="min iterations" type="int" value="10" />
          <Parameter name="time step reduction factor" type="double" value="0.5" />
          <Parameter name="time step increase factor" type="double" value="1.5" />
          <Parameter name="max time step" type="double" value="86400.0" />
          <Parameter name="min time step" type="double" value="1e-10" />
          <Parameter name="growth wait after fail" type="int" value="2" />
          <Parameter name="count before increasing increase factor" type="int" value="2" />
        </ParameterList>
      </ParameterList>

    </ParameterList> <!-- ParameterList name="Top level MPC" -->

    <!-- 'surface subsurface permafrost' mpc included in 'Top level MPC'-->
    <ParameterList name="permafrost surface and subsurface" type="ParameterList">
      <Parameter name="PK type" type="string" value="permafrost model" />
      <Parameter name="PKs order" type="Array(string)" value="{subsurface flow, subsurface energy, surface flow, surface energy}" />

      <Parameter name="supress Jacobian terms: d div q / dT" type="bool" value="false" />
      <Parameter name="supress Jacobian terms: d div K grad T / dp" type="bool" value="false" />
      <Parameter name="supress Jacobian terms: d div hq / dp,T" type="bool" value="true" />
      <Parameter name="supress Jacobian terms: d div surface q / dT" type="bool" value="true" />
      <Parameter name="preconditioner type" type="string" value="picard" />
      <Parameter name="dump preconditioner" type="bool" value="false" />
      
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <ParameterList name="ewc delegate" type="ParameterList">
        <Parameter name="predictor type" type="string" value="smart ewc" />
        <Parameter name="debug cells" type="Array(int)" value="{1}" />
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="extreme" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface ewc delegate" type="ParameterList">
        <Parameter name="predictor type" type="string" value="none" />
        <Parameter name="debug cells" type="Array(int)" value="{0}" />
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="high" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="water delegate" type="ParameterList">
        <Parameter name="modify predictor damp and cap the water spurt" type="bool" value="true" />
        <Parameter name="damp and cap the water spurt" type="bool" value="true" />
        <Parameter name="cap over atmospheric" type="double" value="0.1" />
        <Parameter name="debug cells" type="Array(int)" value="{1}" />
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="extreme" />
        </ParameterList>
      </ParameterList>

      <!--  https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#linear-solvers -->
      <!--  3 methods: direct, iterative, preconditioning method -->
      <!-- NOTE: here bracketed within 'surface subsurface permafrpst' mpc, so applying for all 4 PKs contained in mpc -->
      <ParameterList name="inverse" type="ParameterList">
        <Parameter name="preconditioning method" type="string" value="boomer amg" />
        <ParameterList name="boomer amg parameters" type="ParameterList">
          <Parameter name="cycle applications" type="int" value="1" />
          <Parameter name="smoother sweeps" type="int" value="1" />
          <Parameter name="strong threshold" type="double" value="0.65" />
          <Parameter name="tolerance" type="double" value="0.0" />
          <Parameter name="number of functions" type="int" value="2" />
        </ParameterList>

        <Parameter name="iterative method" type="string" value="gmres" />
        <ParameterList name="gmres parameters" type="ParameterList">
          <Parameter name="preconditioning strategy" type="string" value="left" />
          <Parameter name="error tolerance" type="double" value="1e-06" />
          <Parameter name="convergence criteria" type="Array(string)" value="{relative residual,make one iteration}" />
          <Parameter name="maximum number of iteration" type="int" value="10" />
        </ParameterList>

        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="medium" />
        </ParameterList>

      </ParameterList>    <!-- ParameterList name="inverse" -->

    </ParameterList>      <!-- ParameterList name="surface subsurface permafrost" mpc -->

    <!-- 'subsurface flow' pk included in 'surface subsurface permafrost' mpc PK under 'Top level MPC'-->
    <ParameterList name="subsurface flow" type="ParameterList">
      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#permafrost-flow-pk -->
      <Parameter name="PK type" type="string" value="permafrost flow" />
      <Parameter name="primary variable key" type="string" value="pressure" />
      <Parameter name="source term" type="bool" value="true" />
      <Parameter name="source key" type="string" value="water_source" />
      <Parameter name="source term is differentiable" type="bool" value="false" />
      <Parameter name="initial time step" type="double" value="86400.0" />
      <Parameter name="relative permeability method" type="string" value="upwind with Darcy flux" />
      <Parameter name="surface rel perm strategy" type="string" value="clobber" />
      <Parameter name="permeability rescaling" type="double" value="10000000.0" />
      <Parameter name="max valid change in saturation in a time step [-]" type="double" value="0.1" />
      <Parameter name="max valid change in ice saturation in a time step [-]" type="double" value="0.1" />

      <Parameter name="debug cells" type="Array(int)" value="{0,10,84}" />
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#pde-diffusion -->
      <ParameterList name="diffusion" type="ParameterList">
        <Parameter name="discretization primary" type="string" value="mfd: two-point flux approximation" />
      </ParameterList>

      <!-- optional, The inverse of the diffusion operator, i.e. pde-diffusion above -->
      <ParameterList name="diffusion preconditioner" type="ParameterList">
        <Parameter name="include Newton correction" type="bool" value="true" />
      </ParameterList>

      <ParameterList name="boundary conditions" type="ParameterList">
        <!-- valid name for flow:   pressure, head, fixed level, for Dirichlet-Type BCs, -->
        <!--                    OR, mass flux, fixed level flux, for Neuwman-Type BCs,   -->
        <!--                    OR, seepage face pressure, seepage face head, seepage face with infiltration, zero gradient, critical depth, for specific situations, -->
        <!--                    OR, dynamic, for mixed type-->
      </ParameterList>

      <!-- real initial condition for subsurface permafrost flow pk -->
      <ParameterList name="initial condition" type="ParameterList">
        <Parameter name="restart file" type="string" value="../data/arctic_hydrology_freezeup-checkpoint_final.h5" />
      </ParameterList>

      <!-- specific to Richards + permafrost Water Retention Curve model -->
      <ParameterList name="water retention evaluator" type="ParameterList">
        <Parameter name="minimum rel perm cutoff" type="double" value="0.0" />
        <Parameter name="use surface rel perm" type="bool" value="true" />
        <ParameterList name="WRM parameters" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="WRM Type" type="string" value="van Genuchten" />
            <Parameter name="van Genuchten alpha [Pa^-1]" type="double" value="0.0005" />
            <Parameter name="van Genuchten n [-]" type="double" value="1.39" />
            <Parameter name="residual saturation [-]" type="double" value="0.05" />
            <Parameter name="smoothing interval width [saturation]" type="double" value="0.05" />
          </ParameterList>
          
          <ParameterList name="mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="WRM Type" type="string" value="van Genuchten" />
            <Parameter name="van Genuchten alpha [Pa^-1]" type="double" value="2e-05" />
            <Parameter name="van Genuchten n [-]" type="double" value="1.58" />
            <Parameter name="residual saturation [-]" type="double" value="0.2" />
            <Parameter name="smoothing interval width [saturation]" type="double" value="0.05" />
          </ParameterList>
        </ParameterList>
        
        <ParameterList name="permafrost model parameters" type="ParameterList">
          <Parameter name="permafrost WRM type" type="string" value="fpd permafrost model" />
          <Parameter name="minimum dsi_dpressure magnitude" type="double" value="1e-12" />
        </ParameterList>
        
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="low" />
        </ParameterList>
        
      </ParameterList>    <!-- ParameterList name="water retention evaluator" -->

    </ParameterList>      <!-- ParameterList name='subsurface flow'pk -->

    <!-- 'surface flow' pk included in 'surface subsurface permafrost' mpc PK under 'Top level MPC'-->
    <ParameterList name="surface flow" type="ParameterList">
      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#overland-flow-with-ice -->
      <Parameter name="PK type" type="string" value="overland flow with ice" />
      <Parameter name="primary variable key" type="string" value="surface-pressure" />
      <Parameter name="domain name" type="string" value="surface" />
      <Parameter name="source term" type="bool" value="true" />
      <Parameter name="source key" type="string" value="surface-water_source" />
      <Parameter name="source term is differentiable" type="bool" value="false" />
      <Parameter name="mass source in meters" type="bool" value="true" />
      <Parameter name="initial time step" type="double" value="86400.0" />
      <Parameter name="debug cells" type="Array(int)" value="{0}" />
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <ParameterList name="diffusion" type="ParameterList">
        <Parameter name="discretization primary" type="string" value="fv: default" />
      </ParameterList>

      <ParameterList name="boundary conditions" type="ParameterList">
      </ParameterList>

      <ParameterList name="initial condition" type="ParameterList">
        <Parameter name="initialize surface head from subsurface" type="bool" value="true" />
      </ParameterList>

    </ParameterList>  <!-- ParameterList name='surface flow' -->

    <!-- 'energy' pks for 'surface subsurface permafrost' mpc -->
    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#energy-pks -->
    <!-- currently supported energy PKs: energy base, two-phase energy, three-phase energy, overland energy with ice -->

    <!-- 'subsurface energy' pk included in 'surface subsurface permafrost' mpc PK under 'Top level MPC'-->
    <ParameterList name="subsurface energy" type="ParameterList">
      <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#three-phase-subsurface-energy-pk -->
      <Parameter name="PK type" type="string" value="three-phase energy" />
      <Parameter name="primary variable key" type="string" value="temperature" />
      <Parameter name="source term" type="bool" value="true" />
      <Parameter name="source key" type="string" value="total_energy_source" />
      <Parameter name="source term is differentiable" type="bool" value="false" />
      <Parameter name="initial time step" type="double" value="86400.0" />
      <Parameter name="supress advective terms in preconditioner" type="bool" value="false" />
      <Parameter name="debug cells" type="Array(int)" value="{0,10,84}" />
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <!-- operator for energy: pde-diffusion -->
      <ParameterList name="diffusion" type="ParameterList">
        <Parameter name="discretization primary" type="string" value="mfd: two-point flux approximation" />
      </ParameterList>

      <!-- bc for energy -->
      <ParameterList name="boundary conditions" type="ParameterList">
        <ParameterList name="temperature" type="ParameterList">
          <ParameterList name="bottom" type="ParameterList">
            <Parameter name="regions" type="Array(string)" value="{bottom face}" />
            <ParameterList name="boundary temperature" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="264.15" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <!-- ic for energy -->
      <ParameterList name="initial condition" type="ParameterList">
        <Parameter name="restart file" type="string" value="../data/arctic_hydrology_freezeup-checkpoint_final.h5" />
      </ParameterList>

      <!-- specific to thermal conductivity model -->
      <ParameterList name="thermal conductivity evaluator" type="ParameterList">
        <ParameterList name="thermal conductivity parameters" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="thermal conductivity type" type="string" value="three-phase wet/dry" />
            <Parameter name="thermal conductivity, saturated (unfrozen) [W m^-1 K^-1]" type="double" value="0.67" />
            <Parameter name="thermal conductivity, dry [W m^-1 K^-1]" type="double" value="0.07" />
            <Parameter name="unsaturated alpha frozen [-]" type="double" value="1.0" />
            <Parameter name="unsaturated alpha unfrozen [-]" type="double" value="0.5" />
          </ParameterList>
          
          <ParameterList name="mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="thermal conductivity type" type="string" value="three-phase wet/dry" />
            <Parameter name="thermal conductivity, saturated (unfrozen) [W m^-1 K^-1]" type="double" value="1.0" />
            <Parameter name="thermal conductivity, dry [W m^-1 K^-1]" type="double" value="0.29" />
            <Parameter name="unsaturated alpha frozen [-]" type="double" value="1.0" />
            <Parameter name="unsaturated alpha unfrozen [-]" type="double" value="0.5" />
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="enthalpy evaluator" type="ParameterList">
        <Parameter name="include work term" type="bool" value="false" />
      </ParameterList>

    </ParameterList>  <!-- ParameterList name='subsurface energy' -->

    <!-- 'surface energy' pk included in 'surface subsurface permafrost' mpc PK under 'Top level MPC'-->
    <ParameterList name="surface energy" type="ParameterList">
      <Parameter name="PK type" type="string" value="surface energy" />
      <Parameter name="primary variable key" type="string" value="surface-temperature" />
      <Parameter name="domain name" type="string" value="surface" />
      <Parameter name="source term" type="bool" value="true" />
      <Parameter name="source key" type="string" value="surface-total_energy_source" />
      <Parameter name="source term is differentiable" type="bool" value="true" />
      <Parameter name="source term finite difference" type="bool" value="true" />
      <Parameter name="flux key" type="string" value="surface-mass_flux" />
      <Parameter name="supress advective terms in preconditioner" type="bool" value="true" />
      <Parameter name="initial time step" type="double" value="86400.0" />
      <Parameter name="upwind conductivity method" type="string" value="arithmetic mean" />
      <Parameter name="debug cells" type="Array(int)" value="{0}" />
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <ParameterList name="diffusion" type="ParameterList">
        <Parameter name="discretization primary" type="string" value="fv: default" />
      </ParameterList>

      <ParameterList name="initial condition" type="ParameterList">
        <Parameter name="initialize surface temperature from subsurface" type="bool" value="true" />
      </ParameterList>

      <ParameterList name="boundary conditions" type="ParameterList">
      </ParameterList>

      <ParameterList name="thermal conductivity evaluator" type="ParameterList">
        <ParameterList name="thermal conductivity parameters" type="ParameterList">
          <Parameter name="minimum thermal conductivity" type="double" value="1e-15" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="enthalpy evaluator" type="ParameterList">
        <Parameter name="include work term" type="bool" value="false" />
      </ParameterList>


    </ParameterList>  <!-- ParameterList name='surface energy' -->
    
    <!-- 'SEB' pk included in 'Top level MPC'-->
    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#surface-energy-balance-pks -->
    <ParameterList name="SEB" type="ParameterList">
    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#snow-balance-equation -->
      <Parameter name="PK type" type="string" value="surface balance implicit subgrid" />
      <Parameter name="layer name" type="string" value="snow" />
      <Parameter name="domain name" type="string" value="snow" />
      <Parameter name="primary variable key" type="string" value="snow-depth" />
      <Parameter name="conserved quantity key" type="string" value="snow-water_equivalent" />
      <Parameter name="source term" type="bool" value="true" />
      <Parameter name="source key" type="string" value="snow-source_sink" />
      <Parameter name="source term is differentiable" type="bool" value="false" />
      <Parameter name="roughness length of bare ground [m]" type="double" value="0.04" />
      <Parameter name="roughness length of snow-covered ground [m]" type="double" value="0.004" />
      <Parameter name="debug cells" type="Array(int)" value="{0}" />
      
      <ParameterList name="verbose object" type="ParameterList">
        <Parameter name="verbosity level" type="string" value="high" />
      </ParameterList>

      <ParameterList name="initial condition" type="ParameterList">
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="initial head" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="0.35" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <!--  https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#linear-solvers -->
      <!--  3 methods: direct, iterative, preconditioning method -->
      <!-- NOTE: here only bracketed within 'SEB' pk -->
      <ParameterList name="inverse" type="ParameterList">
        <Parameter name="preconditioning method" type="string" value="identity" />
        <Parameter name="iterative method" type="string" value="gmres" />
        <ParameterList name="gmres parameters" type="ParameterList">
          <Parameter name="preconditioning strategy" type="string" value="left" />
          <Parameter name="error tolerance" type="double" value="1e-06" />
          <Parameter name="convergence criteria" type="Array(string)" value="{relative residual,make one iteration}" />
          <Parameter name="maximum number of iteration" type="int" value="80" />
        </ParameterList>
        
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="high" />
        </ParameterList>
      </ParameterList>

    </ParameterList>     <!-- ParameterList name='SEB' -->

  </ParameterList>     <!-- ParameterList name='PKs' -->


  <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#state -->
  <ParameterList name="state" type="ParameterList">
    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#field-evaluators -->
    <!-- these state variables under 'field evaluators', some are common while some specific to PK,
        and some are required while others may be optional.
        They are all outputs in h5 as configured in 'visualization' parameter-list block.
        But may not all output as configured in 'observation' parameter-list block (have to explicitly pick one or more state.
     -->
    <ParameterList name="field evaluators" type="ParameterList">

      <ParameterList name="water_content" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="liquid+ice water content" />
      </ParameterList>

      <ParameterList name="energy" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="liquid+ice energy" />
      </ParameterList>

      <ParameterList name="surface-water_content" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="overland pressure water content" />
      </ParameterList>

      <ParameterList name="surface-energy" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="surface ice energy" />
        <Parameter name="molar density ice key suffix" type="string" value="molar_density_liquid" />
      </ParameterList>

      <ParameterList name="surface-ponded_depth" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="ponded depth" />
      </ParameterList>

      <ParameterList name="surface-source_molar_density" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="eos" />
        <Parameter name="EOS basis" type="string" value="molar" />
        <ParameterList name="EOS parameters" type="ParameterList">
          <Parameter name="EOS type" type="string" value="liquid water" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="capillary_pressure_gas_liq" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="capillary pressure, atmospheric gas over liquid" />
      </ParameterList>

      <ParameterList name="capillary_pressure_liq_ice" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="capillary pressure, water over ice" />
        <ParameterList name="capillary pressure of ice-water" type="ParameterList">
          <Parameter name="smoothing width [K]" type="double" value="0.2" />
          <Parameter name="interfacial tension ice-water [mN m^-1]" type="double" value="33.1" />
          <Parameter name="interfacial tension air-water [mN m^-1]" type="double" value="72.7" />
          <Parameter name="latent heat [J kg^-1]" type="double" value="334000.0" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-unfrozen_fraction" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="unfrozen fraction" />
        <ParameterList name="unfrozen fraction model" type="ParameterList">
          <Parameter name="transition width [K]" type="double" value="0.2" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-unfrozen_effective_depth" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="unfrozen effective depth" />
      </ParameterList>

      <ParameterList name="molar_density_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="eos" />
        <Parameter name="EOS basis" type="string" value="both" />
        <ParameterList name="EOS parameters" type="ParameterList">
          <Parameter name="EOS type" type="string" value="liquid water" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-molar_density_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="eos" />
        <Parameter name="EOS basis" type="string" value="both" />
        <ParameterList name="EOS parameters" type="ParameterList">
          <Parameter name="EOS type" type="string" value="liquid water" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-mass_density_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="eos" />
        <Parameter name="EOS basis" type="string" value="both" />
        <ParameterList name="EOS parameters" type="ParameterList">
          <Parameter name="EOS type" type="string" value="liquid water" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="viscosity_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="viscosity" />
        <ParameterList name="viscosity model parameters" type="ParameterList">
          <Parameter name="viscosity relation type" type="string" value="liquid water" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-relative_permeability" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="surface rel perm" />
        <ParameterList name="surface rel perm model" type="ParameterList">
          <Parameter name="surface rel perm model type" type="string" value="unfrozen fraction rel perm, limit one" />
          <Parameter name="unfrozen rel perm cutoff pressure [Pa]" type="double" value="10.0" />
          <Parameter name="unfrozen rel perm cutoff pressure, below [Pa]" type="double" value="0.0" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="molar_density_ice" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="eos" />
        <Parameter name="EOS basis" type="string" value="molar" />
        <Parameter name="molar density key" type="string" value="molar_density_ice" />
        <ParameterList name="EOS parameters" type="ParameterList">
          <Parameter name="EOS type" type="string" value="ice" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="internal_energy_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="iem" />
        <Parameter name="internal energy key" type="string" value="internal_energy_liquid" />
        <ParameterList name="IEM parameters" type="ParameterList">
          <Parameter name="IEM type" type="string" value="linear" />
          <Parameter name="heat capacity [J mol^-1 K^-1]" type="double" value="76.0" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-internal_energy_liquid" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="iem" />
        <Parameter name="internal energy key" type="string" value="surface-internal_energy_liquid" />
        <ParameterList name="IEM parameters" type="ParameterList">
          <Parameter name="IEM type" type="string" value="linear" />
          <Parameter name="heat capacity [J mol^-1 K^-1]" type="double" value="76.0" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="internal_energy_rock" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="iem" />
        <Parameter name="internal energy key" type="string" value="internal_energy_rock" />
        <ParameterList name="IEM parameters" type="ParameterList">
          <Parameter name="IEM type" type="string" value="linear" />
          <Parameter name="heat capacity [J kg^-1 K^-1]" type="double" value="620.0" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="internal_energy_ice" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="iem" />
        <Parameter name="internal energy key" type="string" value="internal_energy_ice" />
        <ParameterList name="IEM parameters" type="ParameterList">
          <Parameter name="IEM type" type="string" value="quadratic" />
          <Parameter name="latent heat [J mol^-1]" type="double" value="-6007.87" />
          <Parameter name="heat capacity [J mol^-1 K^-1]" type="double" value="37.7841" />
          <Parameter name="quadratic b [J mol^-1 K^-2]" type="double" value="0.131932" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-internal_energy_ice" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="iem" />
        <Parameter name="internal energy key" type="string" value="surface-internal_energy_ice" />
        <ParameterList name="IEM parameters" type="ParameterList">
          <Parameter name="IEM type" type="string" value="quadratic" />
          <Parameter name="latent heat [J mol^-1]" type="double" value="-6007.87" />
          <Parameter name="heat capacity [J mol^-1 K^-1]" type="double" value="37.7841" />
          <Parameter name="quadratic b [J mol^-1 K^-2]" type="double" value="0.131932" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-manning_coefficient" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="cells" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="components" type="Array(string)" value="{cell,boundary_face}" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="1.0" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="base_porosity" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <Parameter name="constant in time" type="bool" value="true" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="0.85" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
          <ParameterList name="mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="0.5" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="low" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="porosity" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="compressible porosity" />
        <ParameterList name="compressible porosity model parameters" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="pore compressibility [Pa^-1]" type="double" value="1e-07" />
          </ParameterList>
          <ParameterList name="upper mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="pore compressibility [Pa^-1]" type="double" value="1e-08" />
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="permeability" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <Parameter name="constant in time" type="bool" value="true" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="5e-11" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
          <ParameterList name="mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="2e-13" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="low" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="density_rock" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <Parameter name="constant in time" type="bool" value="true" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="peat" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain peat" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="700.0" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
          <ParameterList name="mineral" type="ParameterList">
            <Parameter name="region" type="string" value="subsurface domain mineral" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-constant" type="ParameterList">
                <Parameter name="value" type="double" value="2170.0" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="low" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-incoming_shortwave_radiation" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="incoming shortwave radiation [W m^-2]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-air_temperature" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="air temperature [K]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-relative_humidity" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="relative humidity [-]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-wind_speed" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="wind speed [m s^-1]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-precipitation_rain" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="precipitation rain [m s^-1]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="snow-precipitation" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="independent variable" />
        <ParameterList name="function" type="ParameterList">
          <ParameterList name="domain" type="ParameterList">
            <Parameter name="region" type="string" value="surface domain" />
            <Parameter name="component" type="string" value="cell" />
            <ParameterList name="function" type="ParameterList">
              <ParameterList name="function-tabular" type="ParameterList">
                <Parameter name="file" type="string" value="../data/spinup-10yr.h5" />
                <Parameter name="x header" type="string" value="time [s]" />
                <Parameter name="y header" type="string" value="precipitation snow [m SWE s^-1]" />
              </ParameterList>
            </ParameterList>
          </ParameterList>
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-incoming_longwave_radiation" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="incoming longwave radiation" />
      </ParameterList>

      <ParameterList name="surface-fractional_areas" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="surface balance area fractions" />
      </ParameterList>

      <ParameterList name="snow-water_equivalent" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="multiplicative evaluator" />
        <Parameter name="evaluator dependencies" type="Array(string)" value="{snow-depth,snow-density,snow-cell_volume}" />
        <Parameter name="coefficient" type="double" value="0.001" />
      </ParameterList>

      <ParameterList name="snow-source_sink" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="surface balance" />
        <Parameter name="save diagnostic data" type="bool" value="true" />
        <Parameter name="debug cells" type="Array(int)" value="{0}" />
        <ParameterList name="verbose object" type="ParameterList">
          <Parameter name="verbosity level" type="string" value="high" />
        </ParameterList>
      </ParameterList>

      <ParameterList name="surface-subgrid_albedos" type="ParameterList">
        <Parameter name="field evaluator type" type="string" value="albedo" />
      </ParameterList>

      <ParameterList name="surface-overland_conductivity" type="ParameterList">
        <Parameter name="depth key" type="string" value="surface-unfrozen_effective_depth" />
        <Parameter name="field evaluator type" type="string" value="overland conductivity" />
        <ParameterList name="overland conductivity model" type="ParameterList">
          <Parameter name="Manning exponent" type="double" value="0.666666666667" />
          <Parameter name="slope regularization epsilon" type="double" value="0.01" />
        </ParameterList>
      </ParameterList>

    </ParameterList> <!-- ParameterList name="field evaluators" -->

    <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#initialconditions -->
    <!-- NOT really initial conditions, suggested to rename -->
    <ParameterList name="initial conditions" type="ParameterList">
      <ParameterList name="atmospheric_pressure" type="ParameterList">
        <Parameter name="value" type="double" value="101325.0" />
      </ParameterList>

      <ParameterList name="gravity" type="ParameterList">
        <Parameter name="value" type="Array(double)" value="{0.0,0.0,-9.80665}" />
      </ParameterList>
    </ParameterList>
    
  </ParameterList> <!-- ParameterList name="state" -->
 

 <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#checkpoint -->
 <ParameterList name="checkpoint" type="ParameterList">
   <!-- OPTIONAL. If omitted, by default, ats will produce a restart h5 at end.  -->
   <Parameter name="times start period stop" type="Array(double)" value="{0,1,-1}" />
   <Parameter name="times start period stop units" type="string" value="noleap" />
 </ParameterList>


  <!-- https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#visualization -->  
  <ParameterList name="visualization" type="ParameterList">
    <!-- OPTIONAL. Usually in h5 format with .xmf notation, good to VISIT visualization tool -->
    <ParameterList name="domain" type="ParameterList">
      <Parameter name="times start period stop" type="Array(double)" value="{0.0,1.0,-1.0}" />
      <Parameter name="times start period stop units" type="string" value="d" />
    </ParameterList>
    
    <ParameterList name="surface" type="ParameterList">
      <Parameter name="times start period stop" type="Array(double)" value="{0.0,1.0,-1.0}" />
      <Parameter name="times start period stop units" type="string" value="d" />
    </ParameterList>
    
    <ParameterList name="snow" type="ParameterList">
      <Parameter name="times start period stop" type="Array(double)" value="{0.0,1.0,-1.0}" />
      <Parameter name="times start period stop units" type="string" value="d" />
    </ParameterList>
  </ParameterList>

  <!--  https://amanzi.github.io/ats/input_spec/ATSNativeSpec_dev.html#observation -->
  <ParameterList name="observation" type="ParameterList">
    <!-- OPTIONAL. Usually in ascii format -->
  </ParameterList>


</ParameterList>

